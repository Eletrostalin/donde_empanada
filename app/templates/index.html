<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Application</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <meta name="language" content="ru">
    <style>
        .login-button, .link {
            cursor: pointer;
        }
        .custom-alert {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #444;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
        {% if current_user.is_authenticated %}
            <div class="dropdown">
                <img src="{{ url_for('static', filename='profile.png') }}" alt="Profile" class="dropdown-toggle" onclick="toggleDropdown()">
                <div id="user-dropdown" class="dropdown-content">
                    <a href="#">Аккаунт</a>
                    <a href="{{ url_for('main.logout') }}">Выйти</a>
                </div>
            </div>
        {% else %}
            <div class="login-button" onclick="document.getElementById('login-modal').style.display='block'">Войти</div>
        {% endif %}
    </div>
    <div id="map"></div>
    <div class="custom-button-right" id="add-marker" onclick="promptLocationSelection()">
        <img src="{{ url_for('static', filename='add.png') }}" alt="Add Marker">
    </div>
    <div class="custom-button-right" id="my-location" style="top: 160px;">
        <img src="{{ url_for('static', filename='location.png') }}" alt="My Location">
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <form id="login-form" action="{{ url_for('main.login') }}" method="post" onsubmit="handleLogin(event)">
                {{ form.hidden_tag() }}
                {{ form.csrf_token }}
                <input type="text" name="username" placeholder="Имя пользователя" required>
                <input type="password" name="password" placeholder="Пароль" required>
                <button type="submit">Войти</button>
                <button type="button" onclick="closeLoginForm()">Отмена</button>
                <div class="link" onclick="showRegistrationForm()">Нет аккаунта?</div>
            </form>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registration-modal" class="modal">
        <div class="modal-content">
            <form id="registration-form" action="{{ url_for('main.register') }}" method="post" onsubmit="handleRegistration(event)">
                {{ form.hidden_tag() }}
                {{ form.csrf_token }}
                <input type="text" name="username" placeholder="Имя пользователя" required>
                <input type="text" name="first_name" placeholder="Имя" required>
                <input type="text" name="second_name" placeholder="Фамилия" required>
                <input type="email" name="email" placeholder="Электронная почта" required>
                <input type="text" name="phone" placeholder="Телефон" required>
                <input type="password" name="password" placeholder="Пароль" required>
                <input type="password" name="confirm_password" placeholder="Повторите пароль" required>
                <button type="submit">Зарегистрироваться</button>
                <button type="button" onclick="closeRegistrationForm()">Отмена</button>
            </form>
        </div>
    </div>

    <!-- Add Marker Modal -->
    <div id="add-marker-modal" class="modal">
        <div class="modal-content">
            <form id="add-location-form" action="{{ url_for('main.add_location') }}" method="post" onsubmit="handleAddLocation(event)">
                {{ form.hidden_tag() }}
                {{ form.csrf_token }}
                <input type="text" name="name" placeholder="Название" required>
                <input type="text" name="description" placeholder="Описание" required>
                <input type="text" name="address" placeholder="Адрес" required>
                <input type="text" name="working_hours" placeholder="Часы работы" required>
                <input type="number" name="average_check" placeholder="Средний чек" required>
                <input type="hidden" name="latitude" id="latitude">
                <input type="hidden" name="longitude" id="longitude">
                <button type="submit">Добавить</button>
                <button type="button" onclick="closeAddMarkerForm()">Отмена</button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
        <div class="modal-content">
            <p id="success-message"></p>
        </div>
    </div>

    <!-- Custom Alert -->
    <div id="custom-alert" class="custom-alert">Выберите точку на карте</div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap"></script>
</body>
</html>
